{
  "name": "QuizFlowAI",
  "nodes": [
    {
      "parameters": {
        "formTitle": "Topic",
        "formDescription": "Generate notes on the topic",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Date",
              "fieldType": "date",
              "requiredField": true
            },
            {
              "fieldLabel": "Subject",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "Physics"
                  },
                  {
                    "option": "Chemistry"
                  },
                  {
                    "option": "Biology"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Class",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "9th"
                  },
                  {
                    "option": "10th"
                  },
                  {
                    "option": "11th"
                  },
                  {
                    "option": "12th"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Topic",
              "placeholder": "Enter the topic",
              "requiredField": true
            },
            {
              "fieldLabel": "Subtopics",
              "fieldType": "textarea",
              "placeholder": "Subtopics"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -1888,
        352
      ],
      "id": "8f079707-6052-4a2a-bdff-c39d4df6ef40",
      "name": "On form submission",
      "webhookId": "ed4ab941-32db-4fad-9dc3-c8ae5027c5b3"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-3.5-turbo",
          "mode": "list",
          "cachedResultName": "GPT-3.5-TURBO"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "=\nYou are an expert educational content creator for school students. Generate clear, simple study notes.\n\n**IMPORTANT INSTRUCTIONS:**\n- Write in PLAIN TEXT ONLY - no special symbols, no LaTeX, no markdown\n- Use simple text for mathematical formulas (write \"E = mc^2\" not \"\\[E = mc^2\\]\")\n- Do NOT use asterisks (*), brackets [\\], backslashes (\\), or any formatting symbols\n- Use hyphens (-) for bullet points, NOT asterisks or dots\n- End section headings with a colon (:)\n- Write numbers and formulas in simple text that students can read easily\n\n**Content Details:**\nTopic: {{ $('On form submission').item.json.Topic }}\nSubject: {{ $('On form submission').item.json.Subject }}\nClass: {{ $('On form submission').item.json.Class }}\nSubtopics: {{ $('On form submission').item.json.Subtopics }}\n\n**REQUIRED FORMAT (follow exactly):**\n\nLine 1: Write the main topic with subject in parentheses\n[Example: Electromotive Force (Physics)]\n\nThen for each subtopic, use these section headings:\nDefinition:\nFormula:\nUnit:\nExamples:\nKey Points:\nProperties:\nUses:\nTypes:\n\nUnder each heading, write bullet points starting with hyphen and space (- )\n\n**FORMULA WRITING RULES:**\n- Write \"EMF = V = I Ã— R\" NOT \"\\[EMF = \\varepsilon = I \\times R\\]\"\n- Write \"a^2 + b^2 = c^2\" NOT \"\\[a^2 + b^2 = c^2\\]\"\n- Use Ã— for multiplication, Ã· for division, ^ for powers\n- Use Greek letter names in plain text: \"epsilon\" not \"\\(\\varepsilon\\)\"\n- Write \"theta\" not \"\\(\\theta\\)\", write \"alpha\" not \"\\(\\alpha\\)\"\n\n**CORRECT EXAMPLE:**\n\nElectromotive Force (Physics)\n\nDefinition:\n- EMF stands for Electromotive Force\n- It is the voltage generated by a battery or by the magnetic force according to Faraday's Law\n- It represents the energy provided by a source per unit charge\n\nFormula:\n- EMF = Voltage = Current Ã— Resistance\n- E = V = I Ã— R\n- Where E is EMF measured in volts, I is current in amperes, R is resistance in ohms\n\nUnit:\n- EMF is measured in volts (V)\n- The SI unit is the same as voltage\n\nExamples:\n- A battery with EMF of 9 volts can push current through a circuit\n- Car batteries typically have an EMF of 12 volts\n- Solar cells generate EMF when exposed to light\n\nKey Points:\n- EMF is not actually a force, it is energy per unit charge\n- A higher EMF means more energy available to push charges\n- EMF can be generated by batteries, generators, or solar cells\n\n**WRONG EXAMPLE (Do NOT write like this):**\n\n**Electromotive Force** â† NO asterisks\n\nFormula:\n* \\[EMF = \\varepsilon = I \\times R\\] â† NO LaTeX brackets or backslashes\n* â€¢ where \\(\\varepsilon\\) is the emf â† NO double bullets or LaTeX symbols\n\n**NOW GENERATE THE NOTES:**\nWrite complete study notes following the CORRECT EXAMPLE format above. Use plain text only, simple formulas, and clear bullet points with hyphens."
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -1296,
        336
      ],
      "id": "b4812036-650c-4080-ac34-e16ec9e97df7",
      "name": "Generate Notes",
      "credentials": {
        "openAiApi": {
          "id": "T87ODgO3XEHiOxym",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "=You are an educational quiz maker and {{ $('On form submission').item.json.Subject }} expert.\nBased on the following notes, create exactly 3 multiple choice questions (MCQs).\nEach question must have:\n- question text\n- four options labeled A, B, C, and D\n- correct_option (e.g., \"C) Protons and neutrons\")\n\nOutput the result strictly in JSON format only.\n\nNotes:\n{{ $json.output[0].content[0].text }}\n\n"
            }
          ]
        },
        "simplify": false,
        "builtInTools": {},
        "options": {
          "textFormat": {
            "textOptions": {
              "type": "json_schema",
              "name": "QuizSchema",
              "schema": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"title\": \"QuizSchema\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"quiz_title\": {\n      \"type\": \"string\",\n      \"description\": \"Title or topic of the quiz\"\n    },\n    \"questions\": {\n      \"type\": \"array\",\n      \"description\": \"List of multiple-choice questions\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"question_number\": {\n            \"type\": \"integer\"\n          },\n          \"question_text\": {\n            \"type\": \"string\"\n          },\n          \"options\": {\n            \"type\": \"array\",\n            \"items\": {\n              \"type\": \"string\"\n            }\n          },\n          \"correct_answer\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\"question_number\", \"question_text\", \"options\", \"correct_answer\"],\n        \"additionalProperties\": false\n      }\n    }\n  },\n  \"required\": [\"quiz_title\", \"questions\"],\n  \"additionalProperties\": false\n}\n\n",
              "strict": true
            }
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -944,
        336
      ],
      "id": "ff6941ca-d869-46bf-9109-57737fa6baf5",
      "name": "Generate Quiz",
      "credentials": {
        "openAiApi": {
          "id": "T87ODgO3XEHiOxym",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://script.google.com/macros/s/AKfycbxoMeNdr9w_rQNjsxSqA_FChSyhWifvLDbO4onkOVlvJJa0PTPSWAVhpxg0j2VMDyLArg/exec",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=quiz_title",
              "value": "={{ $('On form submission').item.json.Topic }}"
            },
            {
              "name": "questions",
              "value": "={{ $json.output[0].content[0].text.questions }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -592,
        336
      ],
      "id": "4b6f3ead-b8b0-43be-8d8c-5dd8a76ebc1f",
      "name": "Update Google Form"
    },
    {
      "parameters": {
        "sendTo": "faheem009fbr@gmail.com",
        "subject": "=Today's Notes: {{ $('On form submission').item.json.Topic }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        416,
        96
      ],
      "id": "61aeecb8-a0a9-4d2c-8abc-5b467c63c499",
      "name": "Send a message",
      "webhookId": "563b7f30-512a-4c42-8a83-8a11469c6dd4",
      "credentials": {
        "gmailOAuth2": {
          "id": "vvBiteuUapRhhw0K",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "121cdbee-d5f5-43fc-9dec-c39556a1b833",
              "name": "output[0].content[0].text",
              "value": "={{ $('Generate Notes').item.json.output[0].content[0].text }}",
              "type": "string"
            },
            {
              "id": "79c9db45-2223-44b3-a8e8-d06e695648aa",
              "name": "QuizLink",
              "value": "https://forms.gle/6iHTc9HVYnMsLNMa9",
              "type": "string"
            },
            {
              "id": "4750623b-e031-419a-95f8-8ed8808a3b2c",
              "name": "Class",
              "value": "={{ $('On form submission').item.json.Class }}",
              "type": "string"
            },
            {
              "id": "0b7c9f48-ce4d-44b7-90ee-6759533d856f",
              "name": "Topic",
              "value": "={{ $('On form submission').item.json.Topic }}",
              "type": "string"
            },
            {
              "id": "81af7e9f-a39d-4fe5-8686-7a617eae5b4f",
              "name": "Subject",
              "value": "={{ $('On form submission').item.json.Subject }}",
              "type": "string"
            },
            {
              "id": "57e846e7-0704-4369-a447-1b0be0c10fcb",
              "name": "quiz_raw_data",
              "value": "={{ $('Generate Quiz').item.json.output[0].content[0].text.questions }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -368,
        336
      ],
      "id": "1c022966-0e2b-413c-80c5-3d6b61ef0c90",
      "name": "Notes and Quiz"
    },
    {
      "parameters": {
        "jsCode": "// Parse JSON that is currently a string\nconst quiz = JSON.parse($json.quiz_raw_data);\n\n// Prepare an array of items for Split In Batches\nreturn quiz.map(q => {\n  return {\n    question_number: q.question_number,\n    question_text: q.question_text,\n    options: q.options,\n    correct_answer: q.correct_answer,\n    Class: $json.Class,\n    Topic: $json.Topic,\n    Subject: $json.Subject\n  };\n});\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        624
      ],
      "id": "6b00f280-2a8f-43b8-b081-66b2ed7082eb",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "=Class: {{ $json.Class }}\nTopic: {{ $json.Topic }}\n\nNotes:\n{{ $json.output[0].content[0].text }}\n\nQuiz:\n{{ $json.QuizLink }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "dd20fc1c-618f-477f-a9a6-3ec6640cdea7"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -176,
        336
      ],
      "id": "96dce53c-4964-4407-927d-03b2a7da4980",
      "name": "Switch"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        368,
        608
      ],
      "id": "f28ad658-1605-4440-be64-f45c0b44471d",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        640,
        624
      ],
      "id": "d1e47a99-ed13-4c3e-9072-7918df7f2dc6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d38fe8fd-8081-4c42-b2d3-0bdba2764360",
              "name": "question_number",
              "value": "={{ $json.question_number }}",
              "type": "number"
            },
            {
              "id": "e041edd3-a63a-4347-8bf4-c22429b09246",
              "name": "Question",
              "value": "={{ $json.question_text }}",
              "type": "string"
            },
            {
              "id": "3ee102ac-1f9b-4309-bc8c-c0ef252f903b",
              "name": "CorrectAnswer",
              "value": "={{ $json.correct_answer }}",
              "type": "string"
            },
            {
              "id": "b6aabae1-3bb1-481d-beff-6cf2ac33b768",
              "name": "Class",
              "value": "={{ $json.Class }}",
              "type": "string"
            },
            {
              "id": "acc43962-f81b-49c2-a31e-ece414c1f01d",
              "name": "Subject",
              "value": "={{ $json.Subject }}",
              "type": "string"
            },
            {
              "id": "d8b1061e-0f81-4ea8-b0a7-7476bbb977ee",
              "name": "Topic",
              "value": "={{ $json.Topic }}",
              "type": "string"
            },
            {
              "id": "7bfbb788-eceb-4ec3-b4ef-b4fce9acbb09",
              "name": "Topic",
              "value": "={{ $json.Topic }}",
              "type": "string"
            },
            {
              "id": "d5b57fd8-a218-4160-ade8-76c513c7d0b0",
              "name": "options",
              "value": "={{ $json.options }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        592,
        416
      ],
      "id": "4bd45515-89cd-4309-9b20-a2739ac22b3b",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1mevw9RHoUOgFQAKldSVlH4la3WXMmmGLoZNjPBlOtEc",
          "mode": "list",
          "cachedResultName": "QuizData",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mevw9RHoUOgFQAKldSVlH4la3WXMmmGLoZNjPBlOtEc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1047196372,
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mevw9RHoUOgFQAKldSVlH4la3WXMmmGLoZNjPBlOtEc/edit#gid=1047196372"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "question_number": "={{ $json.question_number }}",
            "question_text": "={{ $json.Question }}",
            "options": "={{ $json.options }}",
            "correct_answer": "={{ $json.CorrectAnswer }}",
            "Class": "={{ $json.Class }}",
            "Topic": "={{ $json.Topic }}",
            "Subject": "={{ $json.Subject }}"
          },
          "matchingColumns": [
            "question_number"
          ],
          "schema": [
            {
              "id": "question_number",
              "displayName": "question_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "question_text",
              "displayName": "question_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "options",
              "displayName": "options",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "correct_answer",
              "displayName": "correct_answer",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Class",
              "displayName": "Class",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Topic",
              "displayName": "Topic",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Subject",
              "displayName": "Subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        816,
        416
      ],
      "id": "c9a9d08e-6059-454b-abb6-8914b44bf62a",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6b9V5o1fLe0XCKUf",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "1Ts8Us6olbOhZU2pKneCg-NSfG9ieQoYs5fJQmp0ESnw",
          "mode": "list",
          "cachedResultName": "Quiz (Responses)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Ts8Us6olbOhZU2pKneCg-NSfG9ieQoYs5fJQmp0ESnw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1932549981,
          "mode": "list",
          "cachedResultName": "Form responses 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Ts8Us6olbOhZU2pKneCg-NSfG9ieQoYs5fJQmp0ESnw/edit#gid=1932549981"
        },
        "event": "rowAdded",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [
        -1568,
        992
      ],
      "id": "318ae225-79f0-4ed4-aa9f-3a9a1296bd26",
      "name": "Trigger",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "QU5Pc2bbsDbLIBkQ",
          "name": "Google Sheets Trigger account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1Ts8Us6olbOhZU2pKneCg-NSfG9ieQoYs5fJQmp0ESnw",
          "mode": "list",
          "cachedResultName": "Quiz (Responses)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Ts8Us6olbOhZU2pKneCg-NSfG9ieQoYs5fJQmp0ESnw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1932549981,
          "mode": "list",
          "cachedResultName": "Form responses 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Ts8Us6olbOhZU2pKneCg-NSfG9ieQoYs5fJQmp0ESnw/edit#gid=1932549981"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1328,
        992
      ],
      "id": "5a203104-982f-4465-8a5d-ce39d003d23c",
      "name": "Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6b9V5o1fLe0XCKUf",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1mevw9RHoUOgFQAKldSVlH4la3WXMmmGLoZNjPBlOtEc",
          "mode": "list",
          "cachedResultName": "QuizData",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mevw9RHoUOgFQAKldSVlH4la3WXMmmGLoZNjPBlOtEc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1047196372,
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mevw9RHoUOgFQAKldSVlH4la3WXMmmGLoZNjPBlOtEc/edit#gid=1047196372"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1088,
        992
      ],
      "id": "866ffe09-37d8-4c2b-9e1a-1e85b2faf687",
      "name": "Google Sheets1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6b9V5o1fLe0XCKUf",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all student responses (multiple submissions)\nconst allStudentResponses = $('Google Sheets').all();\n\n// Get all quiz questions and correct answers\nconst quizDataRaw = $('Google Sheets1').all();\n\n// Remove duplicates from QuizData based on question_text\nconst quizDataMap = new Map();\nfor (const item of quizDataRaw) {\n  const question = item.json;\n  const key = question.question_text.trim().toLowerCase();\n  if (!quizDataMap.has(key)) {\n    quizDataMap.set(key, question);\n  }\n}\nconst quizData = Array.from(quizDataMap.values());\n\n// Helper functions\nfunction normalizeText(text) {\n  if (!text) return '';\n  return text.toString().trim().toLowerCase();\n}\n\nfunction removeQuestionPrefix(text) {\n  if (!text) return '';\n  return text.toString().replace(/^\\d+\\.\\s*/, '').trim();\n}\n\nfunction extractLetter(answer) {\n  if (!answer) return null;\n  const match = answer.toString().match(/^([A-D])\\)/i);\n  return match ? match[1].toUpperCase() : null;\n}\n\nfunction compareAnswers(studentAns, correctAns) {\n  if (!studentAns || !correctAns) return false;\n  \n  const studentNorm = normalizeText(studentAns);\n  const correctNorm = normalizeText(correctAns);\n  \n  if (studentNorm === correctNorm) return true;\n  \n  const studentLetter = extractLetter(studentAns);\n  const correctLetter = extractLetter(correctAns);\n  \n  if (studentLetter && correctLetter) {\n    return studentLetter === correctLetter;\n  }\n  \n  if (/^[A-D]$/i.test(correctAns.toString().trim())) {\n    return studentLetter === correctAns.toString().trim().toUpperCase();\n  }\n  \n  return false;\n}\n\n// Function to score a single student submission\nfunction scoreStudentSubmission(studentResponse, quizData) {\n  const studentName = studentResponse.Name || studentResponse.name || 'Unknown';\n  const studentEmail = studentResponse['Email address'] || studentResponse.Email || '';\n  const timestamp = studentResponse.Timestamp;\n  \n  // Track topics and scores per topic\n  const topicScores = new Map();\n  \n  // Process each question from QuizData\n  for (const quizQuestion of quizData) {\n    const questionText = quizQuestion.question_text;\n    const questionTextNormalized = normalizeText(questionText);\n    const topic = quizQuestion.Topic || quizQuestion.topic || 'Unknown Topic';\n    const subject = quizQuestion.Subject || quizQuestion.subject || 'Unknown Subject';\n    const className = quizQuestion.Class || quizQuestion.class || 'Unknown Class';\n    \n    // Initialize topic if not exists\n    if (!topicScores.has(topic)) {\n      topicScores.set(topic, {\n        topic: topic,\n        subject: subject,\n        class: className,\n        total: 0,\n        correct: 0,\n        wrong: 0,\n        unanswered: 0,\n        details: []\n      });\n    }\n    \n    const topicData = topicScores.get(topic);\n    \n    // Find matching question in student response\n    let studentAnswer = null;\n    let matchedKey = null;\n    \n    for (const key in studentResponse) {\n      if (key === 'Timestamp' || key === 'Email address' || key === 'Score' || key === 'Name') {\n        continue;\n      }\n      \n      const keyWithoutPrefix = removeQuestionPrefix(key);\n      const keyNormalized = normalizeText(keyWithoutPrefix);\n      \n      if (keyNormalized === questionTextNormalized) {\n        studentAnswer = studentResponse[key];\n        matchedKey = key;\n        break;\n      }\n    }\n    \n    // If question found and answered\n    if (matchedKey !== null) {\n      if (studentAnswer && studentAnswer.toString().trim() !== '') {\n        topicData.total++;\n        \n        const correctAnswer = quizQuestion.correct_answer;\n        const isCorrect = compareAnswers(studentAnswer, correctAnswer);\n        \n        if (isCorrect) {\n          topicData.correct++;\n        } else {\n          topicData.wrong++;\n        }\n        \n        topicData.details.push({\n          question_number: quizQuestion.question_number,\n          question_text: questionText,\n          student_answer: studentAnswer,\n          correct_answer: correctAnswer,\n          is_correct: isCorrect\n        });\n      } else {\n        topicData.unanswered++;\n      }\n    }\n  }\n  \n  // Convert topic scores to array with results\n  const results = [];\n  for (const [topic, data] of topicScores.entries()) {\n    if (data.total > 0) { // Only include topics where student answered questions\n      const percentage = (data.correct / data.total * 100).toFixed(2);\n      \n      results.push({\n        submission_timestamp: timestamp,\n        student_name: studentName,\n        student_email: studentEmail,\n        topic: data.topic,\n        subject: data.subject,\n        class: data.class,\n        score_summary: {\n          total_questions: data.total,\n          correct_answers: data.correct,\n          wrong_answers: data.wrong,\n          unanswered: data.unanswered,\n          score_percentage: parseFloat(percentage),\n          pass_status: parseFloat(percentage) >= 60 ? 'PASS' : 'FAIL'\n        },\n        detailed_results: data.details\n      });\n    }\n  }\n  \n  return results;\n}\n\n// Process all student submissions\nconst allResults = [];\n\nfor (const studentItem of allStudentResponses) {\n  const studentResponse = studentItem.json;\n  const studentResults = scoreStudentSubmission(studentResponse, quizData);\n  allResults.push(...studentResults);\n}\n\n// Remove duplicate submissions (keep latest per student per topic)\nconst latestSubmissions = new Map();\n\nfor (const result of allResults) {\n  const key = `${result.student_email}_${result.topic}`;\n  \n  if (!latestSubmissions.has(key)) {\n    latestSubmissions.set(key, result);\n  } else {\n    const existing = latestSubmissions.get(key);\n    // Compare timestamps and keep the latest\n    if (result.submission_timestamp > existing.submission_timestamp) {\n      latestSubmissions.set(key, result);\n    }\n  }\n}\n\n// Convert to array and return\nconst finalResults = Array.from(latestSubmissions.values());\n\n// Sort by timestamp (most recent first)\nfinalResults.sort((a, b) => b.submission_timestamp - a.submission_timestamp);\n\nreturn finalResults.map(result => ({ json: result }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -848,
        992
      ],
      "id": "07d178bd-8589-4cf9-baff-509c0006c522",
      "name": "Result Calculation"
    },
    {
      "parameters": {
        "jsCode": "// Get the data from Save Results sheet\nconst data = $json;\n\n// Extract data from the flattened structure\nconst studentName = data['Student Name'] || data.student_name || 'Student';\nconst studentEmail = data['Email'] || data.email || '';\nconst topic = data['Topic'] || data.topic || '';\nconst subject = data['Subject'] || data.subject || '';\nconst className = data['Class'] || data.class || '';\nconst timestamp = data['Timestamp'] || '';\n\n// Score data\nconst totalQuestions = data['Total Questions'] || 0;\nconst correctAnswers = data['Correct Questions'] || 0;\nconst wrongAnswers = data['Wrong Answers'] || 0;\nconst scorePercentage = data['Score %'] || 0;\nconst status = data['Status'] || '';\n\n// Calculate unanswered (if any)\nconst unanswered = totalQuestions - (correctAnswers + wrongAnswers);\n\n// Determine performance level and color\nlet performanceMessage = '';\nlet performanceColor = '';\nlet performanceEmoji = '';\n\nif (scorePercentage >= 80) {\n  performanceMessage = 'Outstanding Performance! You have mastered this topic!';\n  performanceColor = '#10b981';\n  performanceEmoji = 'ðŸŒŸ';\n} else if (scorePercentage >= 60) {\n  performanceMessage = 'Good Job! Keep practicing to achieve excellence!';\n  performanceColor = '#3b82f6';\n  performanceEmoji = 'ðŸ‘';\n} else if (scorePercentage >= 40) {\n  performanceMessage = 'You are making progress! Review the material and try again.';\n  performanceColor = '#f59e0b';\n  performanceEmoji = 'ðŸ’ª';\n} else {\n  performanceMessage = 'Keep Working Hard! Practice makes perfect!';\n  performanceColor = '#ef4444';\n  performanceEmoji = 'ðŸ“š';\n}\n\n// Calculate percentages for pie chart\nconst correctPercent = totalQuestions > 0 ? ((correctAnswers / totalQuestions) * 100).toFixed(1) : 0;\nconst wrongPercent = totalQuestions > 0 ? ((wrongAnswers / totalQuestions) * 100).toFixed(1) : 0;\n\n// Generate HTML email with charts\nconst htmlContent = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Quiz Result Report</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f4f8;\">\n  \n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f0f4f8; padding: 20px;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #ffffff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n          \n          <!-- Header with Gradient -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 30px; text-align: center;\">\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 32px; font-weight: 700; letter-spacing: -0.5px;\">\n                ${performanceEmoji} Quiz Result Report\n              </h1>\n              <p style=\"margin: 10px 0 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">\n                ${subject} â€¢ ${topic}\n              </p>\n            </td>\n          </tr>\n\n          <!-- Student Info Section -->\n          <tr>\n            <td style=\"padding: 30px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%); border-radius: 12px; padding: 20px;\">\n                <tr>\n                  <td>\n                    <h2 style=\"margin: 0 0 15px 0; color: #1e293b; font-size: 20px; font-weight: 600;\">\n                      ðŸ‘¤ Student Information\n                    </h2>\n                    <table width=\"100%\" cellpadding=\"8\" cellspacing=\"0\" style=\"font-size: 15px;\">\n                      <tr>\n                        <td style=\"color: #64748b; font-weight: 600; width: 140px;\">Name:</td>\n                        <td style=\"color: #1e293b; font-weight: 500;\">${studentName}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"color: #64748b; font-weight: 600;\">Class:</td>\n                        <td style=\"color: #1e293b; font-weight: 500;\">${className}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"color: #64748b; font-weight: 600;\">Subject:</td>\n                        <td style=\"color: #1e293b; font-weight: 500;\">${subject}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"color: #64748b; font-weight: 600;\">Topic:</td>\n                        <td style=\"color: #1e293b; font-weight: 500;\">${topic}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"color: #64748b; font-weight: 600;\">Date:</td>\n                        <td style=\"color: #1e293b; font-weight: 500;\">${timestamp}</td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Score Circle and Performance Message -->\n          <tr>\n            <td style=\"padding: 0 30px 30px 30px; text-align: center;\">\n              \n              <!-- Big Score Circle -->\n              <div style=\"margin: 20px auto; width: 180px; height: 180px; border-radius: 50%; background: ${performanceColor}; box-shadow: 0 8px 16px rgba(0,0,0,0.15);\">\n                <table width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                  <tr>\n                    <td align=\"center\" valign=\"middle\" style=\"color: white; text-align: center;\">\n                      <div style=\"font-size: 35px; font-weight: 700; line-height: 1;\">${scorePercentage}%</div>\n                      <div style=\"font-size: 16px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-top: 5px;\">${status}</div>\n                    </td>\n                  </tr>\n                </table>\n              </div>\n\n\n              <!-- Performance Message -->\n              <div style=\"margin-top: 25px; background-color: #f8fafc; border-left: 4px solid ${performanceColor}; padding: 20px; border-radius: 8px; text-align: left;\">\n                <p style=\"margin: 0; font-size: 18px; color: ${performanceColor}; font-weight: 600; line-height: 1.5;\">\n                  ${performanceMessage}\n                </p>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Statistics Cards -->\n          <tr>\n            <td style=\"padding: 0 30px 30px 30px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                <tr>\n                  <td width=\"48%\" style=\"vertical-align: top;\">\n                    <div style=\"background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #3b82f6;\">\n                      <div style=\"font-size: 42px; font-weight: 700; color: #3b82f6; margin-bottom: 5px;\">${totalQuestions}</div>\n                      <div style=\"font-size: 14px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;\">Total Questions</div>\n                    </div>\n                  </td>\n                  <td width=\"4%\"></td>\n                  <td width=\"48%\" style=\"vertical-align: top;\">\n                    <div style=\"background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #10b981;\">\n                      <div style=\"font-size: 42px; font-weight: 700; color: #10b981; margin-bottom: 5px;\">${correctAnswers}</div>\n                      <div style=\"font-size: 14px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;\">Correct</div>\n                    </div>\n                  </td>\n                </tr>\n                <tr><td colspan=\"3\" height=\"15\"></td></tr>\n                <tr>\n                  <td width=\"48%\" style=\"vertical-align: top;\">\n                    <div style=\"background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #ef4444;\">\n                      <div style=\"font-size: 42px; font-weight: 700; color: #ef4444; margin-bottom: 5px;\">${wrongAnswers}</div>\n                      <div style=\"font-size: 14px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;\">Wrong</div>\n                    </div>\n                  </td>\n                  <td width=\"4%\"></td>\n                  <td width=\"48%\" style=\"vertical-align: top;\">\n                    <div style=\"background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #f59e0b;\">\n                      <div style=\"font-size: 42px; font-weight: 700; color: #f59e0b; margin-bottom: 5px;\">${unanswered}</div>\n                      <div style=\"font-size: 14px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;\">Unanswered</div>\n                    </div>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Progress Bar Chart -->\n          <tr>\n            <td style=\"padding: 0 30px 30px 30px;\">\n              <h3 style=\"margin: 0 0 15px 0; color: #1e293b; font-size: 18px; font-weight: 600;\">\n                ðŸ“Š Performance Breakdown\n              </h3>\n              \n              <!-- Correct Answers Bar -->\n              <div style=\"margin-bottom: 15px;\">\n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\n                  <span style=\"font-size: 14px; color: #64748b; font-weight: 600;\">Correct Answers</span>\n                  <span style=\"font-size: 14px; color: #10b981; font-weight: 700;\">${correctPercent}%</span>\n                </div>\n                <div style=\"background-color: #e5e7eb; border-radius: 10px; height: 20px; overflow: hidden;\">\n                  <div style=\"background: linear-gradient(90deg, #10b981 0%, #059669 100%); height: 100%; width: ${correctPercent}%; border-radius: 10px;\"></div>\n                </div>\n              </div>\n\n              <!-- Wrong Answers Bar -->\n              <div style=\"margin-bottom: 15px;\">\n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\n                  <span style=\"font-size: 14px; color: #64748b; font-weight: 600;\">Wrong Answers</span>\n                  <span style=\"font-size: 14px; color: #ef4444; font-weight: 700;\">${wrongPercent}%</span>\n                </div>\n                <div style=\"background-color: #e5e7eb; border-radius: 10px; height: 20px; overflow: hidden;\">\n                  <div style=\"background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); height: 100%; width: ${wrongPercent}%; border-radius: 10px;\"></div>\n                </div>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Motivational Quote -->\n          <tr>\n            <td style=\"padding: 0 30px 30px 30px;\">\n              <div style=\"background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; padding: 20px; border-radius: 8px;\">\n                <p style=\"margin: 0; font-size: 16px; color: #78350f; font-style: italic; text-align: center; line-height: 1.6;\">\n                  ðŸ’¡ \"Success is the sum of small efforts repeated day in and day out.\"\n                </p>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"background-color: #f8fafc; padding: 25px 30px; text-align: center; border-top: 1px solid #e2e8f0;\">\n              <p style=\"margin: 0 0 10px 0; font-size: 15px; color: #64748b; line-height: 1.6;\">\n                Keep learning and improving! ðŸ“š Your dedication will lead to success.\n              </p>\n              <p style=\"margin: 0; font-size: 13px; color: #94a3b8;\">\n                If you have any questions, please contact your teacher.\n              </p>\n            </td>\n          </tr>\n\n        </table>\n      </td>\n    </tr>\n  </table>\n\n</body>\n</html>\n`;\n\n// Return formatted data for email\nreturn {\n  json: {\n    to: studentEmail,\n    subject: `ðŸ“Š Quiz Result: ${subject} - ${topic} (${scorePercentage}% - ${status})`,\n    html: htmlContent,\n    studentName: studentName,\n    scorePercentage: scorePercentage,\n    status: status\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -400,
        992
      ],
      "id": "f714b27a-3ce8-45e2-b881-2974ea59efd6",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1U_vt4jEyaMwG3Vqh53Z6HhnCCHAnizWWmLKGVLhMpn8",
          "mode": "list",
          "cachedResultName": "QuizResult",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1U_vt4jEyaMwG3Vqh53Z6HhnCCHAnizWWmLKGVLhMpn8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1U_vt4jEyaMwG3Vqh53Z6HhnCCHAnizWWmLKGVLhMpn8/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.submission_timestamp }}",
            "Topic": "={{ $json.topic }}",
            "Student Name": "={{ $json.student_name }}",
            "Email": "={{ $json.student_email }}",
            "Class": "={{ $json.class }}",
            "Subject": "={{ $json.subject }}",
            "Total Questions": "={{ $json.score_summary.total_questions }}",
            "Correct Questions": "={{ $json.score_summary.correct_answers }}",
            "Wrong Answers": "={{ $json.score_summary.wrong_answers }}",
            "Score %": "={{ $json.score_summary.score_percentage }}",
            "Status": "={{ $json.score_summary.pass_status }}"
          },
          "matchingColumns": [
            "Topic"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Student Name",
              "displayName": "Student Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Class",
              "displayName": "Class",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Subject",
              "displayName": "Subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Topic",
              "displayName": "Topic",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Total Questions",
              "displayName": "Total Questions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Correct Questions",
              "displayName": "Correct Questions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Wrong Answers",
              "displayName": "Wrong Answers",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Score %",
              "displayName": "Score %",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -640,
        992
      ],
      "id": "f67bdf2d-ee25-4fae-8f85-6d461c8c07fd",
      "name": "Save Result",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6b9V5o1fLe0XCKUf",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -176,
        992
      ],
      "id": "9b6a89d1-88ee-4231-b5e2-37fb7f22dd1b",
      "name": "Send a message1",
      "webhookId": "7b8566d3-e897-4ddc-a248-263706656769",
      "credentials": {
        "gmailOAuth2": {
          "id": "vvBiteuUapRhhw0K",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "# Generate Dynamic Quiz in Google form\n",
        "height": 512,
        "width": 480,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -672,
        128
      ],
      "typeVersion": 1,
      "id": "034e5cc0-bc26-4f0f-bb4c-44c534ad026b",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# Generate Notes and Quiz                                     ",
        "height": 512,
        "width": 912,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1600,
        128
      ],
      "typeVersion": 1,
      "id": "ec1b58bd-9d20-4a85-b215-b24eac7fd833",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# Fromat the Notes and Send to students\n",
        "height": 272,
        "width": 688,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "fcdd6e46-a163-4f3d-ace3-1032531aa277",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# Extract the quesiton and correct answers from LLM\n## Save One by One to the Sheet\n",
        "height": 480,
        "width": 1008,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        336
      ],
      "typeVersion": 1,
      "id": "60aa06a7-f609-4f85-aebb-7de9459555a0",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Calculate Result and Send Report \n## compare the Student Sumbmitted Answers with the Correct Answers\n## Save the Result to Sheet \n## Send the Detailed Result Report to the Student\n",
        "height": 464,
        "width": 1664,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1648,
        752
      ],
      "typeVersion": 1,
      "id": "995385d5-3940-41c3-99b7-824f0ea1f2d6",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "# Part 1",
        "height": 112,
        "width": 150,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1776,
        128
      ],
      "typeVersion": 1,
      "id": "e7ae0dd7-5736-4314-9690-b23e6f929a71",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "# Part 2",
        "height": 96,
        "width": 150,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1808,
        752
      ],
      "typeVersion": 1,
      "id": "2d35bf4a-df91-4542-be8e-2f9c4f1df594",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "jsCode": "// Get the data from previous node\nconst data = $json;\n\n// Extract information\nconst notesText = data.output[0].content[0].text;\nconst quizLink = data.QuizLink;\nconst className = data.Class;\nconst topic = data.Topic;\nconst subject = data.Subject;\n\n// Function to parse and format notes content\nfunction parseNotes(text) {\n  // AGGRESSIVE CLEANING - Remove all special formatting\n  text = text.replace(/\\*\\*/g, '');           // Remove bold asterisks\n  text = text.replace(/\\*/g, '');             // Remove single asterisks\n  text = text.replace(/#{1,6}\\s/g, '');       // Remove markdown headers\n  text = text.replace(/\\\\\\[/g, '');           // Remove LaTeX opening \\[\n  text = text.replace(/\\\\\\]/g, '');           // Remove LaTeX closing \\]\n  text = text.replace(/\\\\\\(/g, '');           // Remove LaTeX opening \\(\n  text = text.replace(/\\\\\\)/g, '');           // Remove LaTeX closing \\)\n  text = text.replace(/\\\\varepsilon/g, 'E');  // Replace epsilon symbol\n  text = text.replace(/\\\\theta/g, 'theta');   // Replace theta\n  text = text.replace(/\\\\alpha/g, 'alpha');   // Replace alpha\n  text = text.replace(/\\\\beta/g, 'beta');     // Replace beta\n  text = text.replace(/\\\\times/g, 'Ã—');       // Replace times\n  text = text.replace(/\\\\div/g, 'Ã·');         // Replace division\n  text = text.replace(/\\\\/g, '');             // Remove remaining backslashes\n  text = text.replace(/^[\\s]*[*â€¢]\\s/gm, '- '); // Normalize all bullets to hyphens\n  \n  const lines = text.split('\\n').filter(line => line.trim() !== '');\n  let html = '';\n  let inList = false;\n  let inSection = false;\n  let foundMainHeading = false;\n  \n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    \n    // Skip empty lines\n    if (!line) continue;\n    \n    // Detect main heading (first substantial line or line with parentheses containing subject)\n    const hasParentheses = /\\([A-Za-z\\s]+\\)/.test(line);\n    const isFirstLine = i === 0 || (!foundMainHeading && i < 3);\n    const looksLikeTitle = line.length < 100 && !line.endsWith(':') && !line.startsWith('-');\n    \n    const isMainHeading = !foundMainHeading && (hasParentheses || (isFirstLine && looksLikeTitle));\n    \n    if (isMainHeading) {\n      foundMainHeading = true;\n      \n      // Close previous section if open\n      if (inList) {\n        html += '</ul>';\n        inList = false;\n      }\n      if (inSection) {\n        html += '</div>';\n        inSection = false;\n      }\n      \n      // Main heading - Large and colorful\n      html += `<div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);\">\n                <h2 style=\"color: #ffffff; font-size: 26px; font-weight: 700; margin: 0; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.2);\">\n                  ðŸ“˜ ${line}\n                </h2>\n              </div>`;\n    }\n    // Detect subheadings (ending with colon)\n    else if (line.endsWith(':') && !line.startsWith('-')) {\n      // Close previous list if open\n      if (inList) {\n        html += '</ul>';\n        inList = false;\n      }\n      // Close previous section if open\n      if (inSection) {\n        html += '</div>';\n      }\n      \n      const sectionTitle = line.replace(':', '').trim();\n      \n      // Enhanced icon and color mapping\n      const iconMap = {\n        'Definition': { icon: 'ðŸ“–', color: '#3b82f6', bgGradient: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)' },\n        'Formula': { icon: 'ðŸ”¢', color: '#8b5cf6', bgGradient: 'linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)' },\n        'Formulas': { icon: 'ðŸ”¢', color: '#8b5cf6', bgGradient: 'linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)' },\n        'Unit': { icon: 'ðŸ“', color: '#10b981', bgGradient: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' },\n        'Units': { icon: 'ðŸ“', color: '#10b981', bgGradient: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' },\n        'Example': { icon: 'ðŸ’¡', color: '#f59e0b', bgGradient: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' },\n        'Examples': { icon: 'ðŸ’¡', color: '#f59e0b', bgGradient: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' },\n        'Key Points': { icon: 'ðŸ”‘', color: '#ef4444', bgGradient: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)' },\n        'Important': { icon: 'âš ï¸', color: '#dc2626', bgGradient: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)' },\n        'Note': { icon: 'ðŸ“', color: '#6366f1', bgGradient: 'linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%)' },\n        'Notes': { icon: 'ðŸ“', color: '#6366f1', bgGradient: 'linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%)' },\n        'Uses': { icon: 'âš™ï¸', color: '#059669', bgGradient: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' },\n        'Applications': { icon: 'âš™ï¸', color: '#059669', bgGradient: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' },\n        'Properties': { icon: 'âœ¨', color: '#7c3aed', bgGradient: 'linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)' },\n        'Types': { icon: 'ðŸ“‹', color: '#0891b2', bgGradient: 'linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)' },\n        'Characteristics': { icon: 'ðŸŽ¯', color: '#d946ef', bgGradient: 'linear-gradient(135deg, #fae8ff 0%, #f5d0fe 100%)' },\n        'Explanation': { icon: 'ðŸ“š', color: '#2563eb', bgGradient: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)' }\n      };\n      \n      const sectionData = iconMap[sectionTitle] || { \n        icon: 'ðŸ“Œ', \n        color: '#667eea', \n        bgGradient: 'linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%)' \n      };\n      \n      html += `<div style=\"background: ${sectionData.bgGradient}; border-left: 5px solid ${sectionData.color}; padding: 20px 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);\">\n                <h3 style=\"color: ${sectionData.color}; font-size: 19px; font-weight: 700; margin: 0 0 12px 0; display: flex; align-items: center; gap: 8px;\">\n                  <span style=\"font-size: 22px;\">${sectionData.icon}</span>\n                  <span>${sectionTitle}</span>\n                </h3>`;\n      inSection = true;\n    }\n    // List items (starting with - or â€¢)\n    else if (line.startsWith('-') || line.startsWith('â€¢')) {\n      if (!inList) {\n        html += '<ul style=\"margin: 0; padding-left: 25px; list-style: none;\">';\n        inList = true;\n      }\n      const content = line.substring(1).trim();\n      html += `<li style=\"margin-bottom: 10px; padding-left: 10px; position: relative; line-height: 1.7; color: #334155; font-size: 15px;\">\n                <span style=\"position: absolute; left: -15px; color: #667eea; font-weight: bold; font-size: 18px;\">â€¢</span>\n                ${content}\n              </li>`;\n    }\n    // Regular paragraph text\n    else {\n      if (inList) {\n        html += '</ul>';\n        inList = false;\n      }\n      html += `<p style=\"margin: 0 0 10px 0; line-height: 1.7; color: #1e293b; font-size: 15px;\">${line}</p>`;\n    }\n  }\n  \n  // Close any open tags\n  if (inList) {\n    html += '</ul>';\n  }\n  if (inSection) {\n    html += '</div>';\n  }\n  \n  return html;\n}\n\n// Parse the notes\nconst formattedNotes = parseNotes(notesText);\n\n// Create beautiful HTML email\nconst htmlContent = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Study Notes - ${topic}</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f4f8;\">\n  \n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f0f4f8; padding: 20px;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"700\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #ffffff; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\">\n          \n          <!-- Compact Header with Gradient -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 40px; text-align: center;\">\n              <div style=\"display: inline-block; background-color: rgba(255,255,255,0.2); padding: 6px 16px; border-radius: 50px; margin-bottom: 10px;\">\n                <span style=\"color: white; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5px;\">\n                  ${subject} â€¢ Class ${className}\n                </span>\n              </div>\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 32px; font-weight: 800; letter-spacing: -0.5px; text-shadow: 0 2px 8px rgba(0,0,0,0.2);\">\n                ðŸ“š ${topic}\n              </h1>\n              <p style=\"margin: 8px 0 0 0; color: rgba(255,255,255,0.95); font-size: 15px; font-weight: 400;\">\n                Your Complete Study Guide\n              </p>\n            </td>\n          </tr>\n\n          <!-- Welcome Message -->\n          <tr>\n            <td style=\"padding: 30px 40px 25px 40px;\">\n              <div style=\"background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%); border-radius: 10px; padding: 20px; text-align: center; border: 2px solid #c7d2fe;\">\n                <p style=\"margin: 0; font-size: 16px; color: #4c1d95; font-weight: 600; line-height: 1.5;\">\n                  ðŸŽ“ Welcome to your personalized study notes! \n                </p>\n                <p style=\"margin: 8px 0 0 0; font-size: 14px; color: #6b21a8; line-height: 1.5;\">\n                  Read carefully, understand the concepts, and you'll be ready to ace the quiz!\n                </p>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Main Content - Formatted Notes -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              ${formattedNotes}\n            </td>\n          </tr>\n\n          <!-- Quiz Call-to-Action -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              <div style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 14px; padding: 30px; text-align: center; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);\">\n                <h2 style=\"margin: 0 0 12px 0; color: #ffffff; font-size: 24px; font-weight: 700;\">\n                  ðŸŽ¯ Ready to Test Your Knowledge?\n                </h2>\n                <p style=\"margin: 0 0 20px 0; color: rgba(255,255,255,0.95); font-size: 15px; line-height: 1.5;\">\n                  You've got this! Click the button below to start your quiz.\n                </p>\n                <a href=\"${quizLink}\" style=\"display: inline-block; background-color: #ffffff; color: #059669; text-decoration: none; padding: 14px 35px; border-radius: 50px; font-size: 17px; font-weight: 700; box-shadow: 0 4px 12px rgba(0,0,0,0.2);\">\n                  Start Quiz Now ðŸš€\n                </a>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Study Tips Section -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              <div style=\"background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 20px; border-radius: 8px;\">\n                <h3 style=\"margin: 0 0 12px 0; color: #92400e; font-size: 18px; font-weight: 600;\">\n                  ðŸ’¡ Study Tips\n                </h3>\n                <ul style=\"margin: 0; padding-left: 20px; color: #78350f; line-height: 1.6; font-size: 14px;\">\n                  <li style=\"margin-bottom: 8px;\">Read through all the notes at least twice</li>\n                  <li style=\"margin-bottom: 8px;\">Write down the formulas and practice them</li>\n                  <li style=\"margin-bottom: 8px;\">Try to explain the concept to someone else</li>\n                  <li>Take your time with the quiz - there's no rush!</li>\n                </ul>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Motivational Quote -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              <div style=\"text-align: center; padding: 25px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 10px; border: 2px dashed #10b981;\">\n                <p style=\"margin: 0; font-size: 17px; color: #065f46; font-style: italic; font-weight: 500; line-height: 1.5;\">\n                  \"The expert in anything was once a beginner.\"\n                </p>\n                <p style=\"margin: 8px 0 0 0; font-size: 13px; color: #059669; font-weight: 600;\">\n                  - Keep Learning, Keep Growing! ðŸŒ±\n                </p>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 30px 40px; text-align: center;\">\n              <p style=\"margin: 0 0 10px 0; font-size: 16px; color: #e2e8f0; font-weight: 600;\">\n                ðŸ“– Happy Learning!\n              </p>\n              <p style=\"margin: 0; font-size: 14px; color: #94a3b8; line-height: 1.6;\">\n                Study well and give your best in the quiz. We believe in you! ðŸ’ª\n              </p>\n              <div style=\"margin-top: 20px; padding-top: 20px; border-top: 1px solid #334155;\">\n                <p style=\"margin: 0; font-size: 12px; color: #64748b;\">\n                  If you have any questions, feel free to reach out to your teacher.\n                </p>\n              </div>\n            </td>\n          </tr>\n\n        </table>\n      </td>\n    </tr>\n  </table>\n\n</body>\n</html>\n`;\n\n// Return the formatted email content\nreturn {\n  json: {\n    subject: `ðŸ“š Study Notes: ${subject} - ${topic} (Class ${className})`,\n    html: htmlContent,\n    topic: topic,\n    subject: subject,\n    class: className,\n    quizLink: quizLink\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        160,
        96
      ],
      "id": "5abdfdce-333f-421e-9dad-f6534e459722",
      "name": "Beautify the Notes"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "quiz-automation-test",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        224,
        1424
      ],
      "id": "1058e5d0-65ef-49c6-a422-d4f40b65fb5e",
      "name": "Webhook",
      "webhookId": "52e1b0d4-46a0-4228-aaea-589748d99a05"
    }
  ],
  "pinData": {},
  "connections": {
    "On form submission": {
      "main": [
        []
      ]
    },
    "Generate Notes": {
      "main": [
        [
          {
            "node": "Generate Quiz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Quiz": {
      "main": [
        [
          {
            "node": "Update Google Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Google Form": {
      "main": [
        [
          {
            "node": "Notes and Quiz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notes and Quiz": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          },
          {
            "node": "Beautify the Notes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "Google Sheets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets1": {
      "main": [
        [
          {
            "node": "Result Calculation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Result Calculation": {
      "main": [
        [
          {
            "node": "Save Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Result": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Beautify the Notes": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "333e6809-f817-4f50-9f64-ccb077740847",
  "meta": {
    "instanceId": "db8ba1380a6a4bfdc8e31ec6e3823802483c2445ee61f1d6c83734bf89932e97"
  },
  "id": "mX2tQgnieZKzTVAO",
  "tags": []
}